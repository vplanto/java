# –ü—Ä–∞–∫—Ç–∏–∫—É–º 4: –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ç–∞ –û–±—Ä–æ–±–∫–∞ –ü–æ–º–∏–ª–æ–∫ (Production Ready)

**–¢–∏–ø:** Hands-on Lab
**–†—ñ–≤–µ–Ω—å:** Junior Strong
**–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤–∏–º–æ–≥–∏:** –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Å–µ—Ä–≤—ñ—Å –∑ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó ‚Ññ3.
**–Ü–Ω–∂–µ–Ω–µ—Ä–Ω–∞ –º–µ—Ç–∞:** –ó—Ä–æ–∑—É–º—ñ—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø "12-Factor App" (Config in environment) —Ç–∞ –Ω–∞–≤—á–∏—Ç–∏—Å—è –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ–º–∏–ª–∫–∏ (–Ω–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç—É StackTrace).
**–ë—ñ–∑–Ω–µ—Å-–∑–∞–¥–∞—á–∞:** –í–∏–Ω–µ—Å—Ç–∏ –∫—É—Ä—Å –≤–∞–ª—é—Ç —É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ API –≤—ñ–¥ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö.

---

##  –ï–∫—Å–ø—Ä–µ—Å-–æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è: Operations Check

1.  **Deployment:** –Ø–∫—â–æ –≤–∏ –∑–º—ñ–Ω–∏–ª–∏ –æ–¥–∏–Ω —Ä—è–¥–æ–∫ –∫–æ–¥—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫—É—Ä—Å –¥–æ–ª–∞—Ä–∞), —Å–∫—ñ–ª—å–∫–∏ —á–∞—Å—É –∑–∞–π–º–∞—î –¥–æ—Å—Ç–∞–≤–∫–∞ —Ü—ñ—î—ó –∑–º—ñ–Ω–∏ –Ω–∞ Production (Commit -> Build -> Deploy)?
2.  **HTTP Standards:** –ß–∏–º –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å `400 Bad Request` –≤—ñ–¥ `500 Internal Server Error` –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É –∫–ª—ñ—î–Ω—Ç–∞?
3.  **Security:** –ß–∏ –±–µ–∑–ø–µ—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –ø–∞—Ä–æ–ª—å –≤—ñ–¥ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É —Ñ–∞–π–ª—ñ `application.properties`, —è–∫—â–æ —Ü–µ–π —Ñ–∞–π–ª –ø–æ—Ç—Ä–∞–ø–ª—è—î —É GitHub?

<details markdown="1">
<summary>–í—ñ–¥–ø–æ–≤—ñ–¥—ñ (–°–∞–º–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞)</summary>

1.  **–í—ñ–¥ 10 –¥–æ 40 —Ö–≤–∏–ª–∏–Ω.** –¶–µ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è "Downtime" –∞–±–æ "Release Cycle". –ó–º—ñ–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –º–∞—î –∑–∞–π–º–∞—Ç–∏ —Å–µ–∫—É–Ω–¥–∏ (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—É), –∞ –Ω–µ —Ö–≤–∏–ª–∏–Ω–∏ (–ø–µ—Ä–µ–∑–±—ñ—Ä–∫–∞).
2.  **–í–∏–Ω–æ—é.** `400` ‚Äî –≤–∏–Ω–µ–Ω –∫–ª—ñ—î–Ω—Ç (–Ω–∞–¥—ñ—Å–ª–∞–≤ –∫—Ä–∏–≤—ñ –¥–∞–Ω—ñ). –í—ñ–Ω –º–∞—î –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞–ø–∏—Ç. `500` ‚Äî –≤–∏–Ω–µ–Ω —Å–µ—Ä–≤–µ—Ä (–≤–ø–∞–ª–∞ –±–∞–∑–∞, NPE). –ö–ª—ñ—î–Ω—Ç –Ω—ñ—á–æ–≥–æ –Ω–µ –º–æ–∂–µ –∑—Ä–æ–±–∏—Ç–∏, —Ç—ñ–ª—å–∫–∏ —á–µ–∫–∞—Ç–∏.
3.  **–ù—ñ.** –¶–µ –≤–∏—Ç—ñ–∫ —Å–µ–∫—Ä–µ—Ç—ñ–≤. –£ Git –º–æ–∂–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –ª–∏—à–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω—Ñ—ñ–≥—É –∞–±–æ –¥–µ—Ñ–æ–ª—Ç–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è Dev-—Å–µ—Ä–µ–¥–æ–≤–∏—â–∞. –ü–∞—Ä–æ–ª—ñ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è (Environment Variables) –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É.

</details>

---

## üõë Stop & Think: Hardcode is Evil

–£ –≤–∞—à–æ–º—É –∫–æ–¥—ñ –∑–∞—Ä–∞–∑ —î —Ä—è–¥–æ–∫:
`private static final double USD_RATE = 38.5;`

**–Ü–Ω–∂–µ–Ω–µ—Ä–Ω–∏–π —Ä–æ–∑–±—ñ—Ä:**
–©–æ–± –∑–º—ñ–Ω–∏—Ç–∏ –∫—É—Ä—Å –≤–∞–ª—é—Ç, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ:
1.  –ó–º—ñ–Ω–∏—Ç–∏ Java-–∫–æ–¥.
2.  –°–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç.
3.  –ó—É–ø–∏–Ω–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä -> –ó–∞–ª–∏—Ç–∏ –Ω–æ–≤—É –≤–µ—Ä—Å—ñ—é -> –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä.

–¶–µ –Ω–µ–ø—Ä–∏–ø—É—Å—Ç–∏–º–æ –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, —â–æ —á–∞—Å—Ç–æ –∑–º—ñ–Ω—é—é—Ç—å—Å—è.

---

## –ö—Ä–æ–∫ 1. External Configuration (`application.properties`)

Spring Boot –¥–æ–∑–≤–æ–ª—è—î –≤–∏–Ω–µ—Å—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —É –∑–æ–≤–Ω—ñ—à–Ω—ñ —Ñ–∞–π–ª–∏ –∞–±–æ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.

1.  –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª `src/main/resources/application.properties`.
2.  –î–æ–¥–∞–π—Ç–µ —Ç—É–¥–∏ –±—ñ–∑–Ω–µ—Å-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏:
    ```properties
    # Business Logic Config
    app.currency.usd-rate=38.5
    app.currency.commission=0.01
    ```

3.  –ú–æ–¥–∏—Ñ—ñ–∫—É–π—Ç–µ `CurrencyService`. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∞–Ω–æ—Ç–∞—Ü—ñ—é `@Value`, —â–æ–± Spring "–≤–ø–æ—Ä—Å–Ω—É–≤" –∑–Ω–∞—á–µ–Ω–Ω—è –∑ —Ñ–∞–π–ª—É.

```java
@Service
public class CurrencyService {

    private final double usdRate;
    private final double commission;

    // Spring —Å–∞–º –∑–Ω–∞–π–¥–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Ñ–∞–π–ª—ñ properties —ñ –ø—ñ–¥—Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
    public CurrencyService(
            @Value("${app.currency.usd-rate}") double usdRate,
            @Value("${app.currency.commission}") double commission) {
        this.usdRate = usdRate;
        this.commission = commission;
    }

    public double buyEuro(double uahAmount) {
        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ this.usdRate –∑–∞–º—ñ—Å—Ç—å —Ö–∞—Ä–¥–∫–æ–¥—É
        // ... –ª–æ–≥—ñ–∫–∞ ...
    }
}

```

> **–ü–µ—Ä–µ–º–æ–≥–∞:** –¢–µ–ø–µ—Ä –∫—É—Ä—Å –≤–∞–ª—é—Ç –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞–≤—ñ—Ç—å —á–µ—Ä–µ–∑ –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (`--app.currency.usd-rate=40.0`), –Ω–µ —á—ñ–ø–∞—é—á–∏ –∫–æ–¥.

---

## –ö—Ä–æ–∫ 2. –ì–ª–æ–±–∞–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ (Global Exception Handling)
–°–ø—Ä–æ–±—É–π—Ç–µ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞–ø–∏—Ç –∑ –≤—ñ–¥'—î–º–Ω–æ—é —Å—É–º–æ—é: `/api/currency/convert?amount=-100`.
–Ø–∫—â–æ –≤–∏ –¥–æ–¥–∞–ª–∏ –ø—Ä–æ—Å—Ç—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É `throw new RuntimeException(...)`, –∫–ª—ñ—î–Ω—Ç –æ—Ç—Ä–∏–º–∞—î —Å—Ç–∞—Ç—É—Å `500 Internal Server Error` —ñ –∫—É–ø—É —Å—Ç—Ä–∞—à–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É (Stack Trace).

**–¶–µ –Ω–µ–ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ.**

* –ü–æ–º–∏–ª–∫–∞ –∫–ª—ñ—î–Ω—Ç–∞ (–Ω–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ) ‚Äî —Ü–µ —Å—Ç–∞—Ç—É—Å `400 Bad Request`.
* JSON –º–∞—î –±—É—Ç–∏ —á–∏—Å—Ç–∏–º: `{"error": "–°—É–º–∞ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥'—î–º–Ω–æ—é"}`.

### –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:
Spring –º–∞—î –º–µ—Ö–∞–Ω—ñ–∑–º "–ü–µ—Ä–µ—Ö–æ–ø–ª—é–≤–∞—á–∞ –ø–æ–º–∏–ª–æ–∫" ‚Äî `@RestControllerAdvice`.

1. –°—Ç–≤–æ—Ä—ñ—Ç—å –ø–∞–∫–µ—Ç `exception`.
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–ª–∞—Å `GlobalExceptionHandler`.

```java
package ua.edu.demoservice.exception;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import java.util.Map;

@RestControllerAdvice // –¶–µ–π –∫–ª–∞—Å –ª–æ–≤–∏—Ç—å –ø–æ–º–∏–ª–∫–∏ –∑ –£–°–Ü–• –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ–≤ (AOP)
public class GlobalExceptionHandler {

    @ExceptionHandler(IllegalArgumentException.class) // –Ø–∫—É –ø–æ–º–∏–ª–∫—É –ª–æ–≤–∏–º–æ
    public ResponseEntity<Map<String, String>> handleBadInput(IllegalArgumentException e) {
        // –§–æ—Ä–º—É—î–º–æ –∫—Ä–∞—Å–∏–≤—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å 400 Bad Request
        return ResponseEntity
                .badRequest()
                .body(Map.of("error", e.getMessage()));
    }
}

```

3. –û–Ω–æ–≤—ñ—Ç—å `CurrencyService`, —â–æ–± –≤—ñ–Ω –∫–∏–¥–∞–≤ —Å–∞–º–µ —Ü—é –ø–æ–º–∏–ª–∫—É:
```java
public double buyEuro(double uahAmount) {
    if (uahAmount <= 0) {
        throw new IllegalArgumentException("–°—É–º–∞ –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–µ –Ω—É–ª—è");
    }
    // ...
}

```



---

##  –ó–∞–≤–¥–∞–Ω–Ω—è "–ù–∞ –∑–∞—Ö–∏—Å—Ç" (Challenge)
–£ –≤–∞—Å —î —Ñ–∞–π–ª `application.properties`.
–†–µ–∞–ª—ñ–∑—É–π—Ç–µ –º–µ—Ö–∞–Ω—ñ–∑–º, –¥–µ **–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É** —Ç–∞–∫–æ–∂ –≤–∏–Ω–µ—Å–µ–Ω–µ –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é.

–¢–æ–±—Ç–æ:

1. –£ –ø—Ä–æ–ø–µ—Ä—Ç—ñ —Ñ–∞–π–ª—ñ: `app.messages.error.negative-amount=–ù–µ –º–æ–∂–Ω–∞ –º—ñ–Ω—è—Ç–∏ –ø–æ–≤—ñ—Ç—Ä—è –Ω–∞ –≥—Ä–æ—à—ñ!`
2. –ü—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –±–∞—á–∏—Ç–∏ —Å–∞–º–µ —Ü–µ–π —Ç–µ–∫—Å—Ç.

**–ü–∏—Ç–∞–Ω–Ω—è –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É:**
–ß–æ–º—É –º–∏ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ `Map.of("error", ...)` –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä—è–¥–æ–∫? –Ø–∫ —Ü–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ Frontend —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞?

<details markdown="1">
<summary>–í—ñ–¥–ø–æ–≤—ñ–¥—å</summary>

Frontend –∑–∞–≤–∂–¥–∏ –æ—á—ñ–∫—É—î **JSON**.
–Ø–∫—â–æ API –ø–æ–≤–µ—Ä–Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä—è–¥–æ–∫ `"Error"`, JavaScript –∫–æ–¥ `JSON.parse(response)` –≤–ø–∞–¥–µ –∑ –ø–æ–º–∏–ª–∫–æ—é, –±–æ —Ü–µ –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–π JSON. –û–±'—î–∫—Ç `{"error": "message"}` ‚Äî —Ü–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.

</details>

---

##  –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è
1. **Environment Variables:** –£ –≤–∞—Å —î –ø–∞—Ä–∞–º–µ—Ç—Ä `app.password` –≤ `application.properties`. –ß–æ–º—É –∫–æ–º—ñ—Ç–∏—Ç–∏ —Ü–µ–π —Ñ–∞–π–ª –≤ Git –∑ —Ä–µ–∞–ª—å–Ω–∏–º –ø–∞—Ä–æ–ª–µ–º ‚Äî —Ü–µ –∑–ª–æ—á–∏–Ω? –Ø–∫ Spring –¥–æ–∑–≤–æ–ª—è—î —Ü–µ –æ–±—ñ–π—Ç–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É?
2. **HTTP Codes:** –í–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –ø—Ä–∞—Ü—é—î —ñ–¥–µ–∞–ª—å–Ω–æ, –∞–ª–µ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –≤–ø–∞–ª–∞. –Ø–∫–∏–π –∫–æ–¥ –º–∞—î –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç: 200, 400 —á–∏ 500? –•—Ç–æ –∑–∞ —Ü–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —É –≤–∞—à–æ–º—É –Ω–æ–≤–æ–º—É –∫–æ–¥—ñ?
3. **Architecture:** `@RestControllerAdvice` ‚Äî —Ü–µ —á–∞—Å—Ç–∏–Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞, —Å–µ—Ä–≤—ñ—Å—É —á–∏ –æ–∫—Ä–µ–º–∏–π –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π –ø–∞—Ç–µ—Ä–Ω?

<details markdown="1">
<summary>–í—ñ–¥–ø–æ–≤—ñ–¥—ñ</summary>

1. **Security.** –ü–∞—Ä–æ–ª—ñ –≤ Git ‚Äî —Ü–µ –≤–∏—Ç—ñ–∫ –¥–∞–Ω–∏—Ö. Spring –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –±—É–¥—å-—è–∫—É –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –∑–∞–ø—É—Å–∫—É (`java -jar app.jar --app.password=123`) –∞–±–æ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –û–° (`export APP_PASSWORD=123`).
2. **500 Internal Server Error.** –¶–µ –Ω–µ –≤–∏–Ω–∞ –∫–ª—ñ—î–Ω—Ç–∞, —Ü–µ –≤–∏–Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞. –Ø–∫—â–æ –º–∏ –Ω–µ –ø–µ—Ä–µ—Ö–æ–ø–∏–ª–∏ —Ü–µ–π –≤–∏–Ω—è—Ç–æ–∫ —è–≤–Ω–æ, Spring Boot –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø–æ–≤–µ—Ä–Ω–µ 500. –ù–∞—à `GlobalExceptionHandler` –ø–æ–≤–∏–Ω–µ–Ω –º–∞—Ç–∏ –º–µ—Ç–æ–¥ –¥–ª—è `Exception.class` (general), —â–æ–± –Ω–µ —Å–≤—ñ—Ç–∏—Ç–∏ –¥–µ—Ç–∞–ª—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.
3. **AOP (Aspect Oriented Programming).** –¶–µ –Ω–∞—Å–∫—Ä—ñ–∑–Ω–∞ –ª–æ–≥—ñ–∫–∞. –ú–∏ "–≤–∫–ª–∏–Ω—é—î–º–æ—Å—å" —É –ø—Ä–æ—Ü–µ—Å –æ–±—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—É, —è–∫—â–æ —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞, –Ω–µ –∑–º—ñ–Ω—é—é—á–∏ –∫–æ–¥ —Å–∞–º–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞. –¶–µ –¥–æ–∑–≤–æ–ª—è—î —Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ —á–∏—Å—Ç–∏–º–∏.

</details>
